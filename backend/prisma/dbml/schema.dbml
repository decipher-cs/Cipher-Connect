//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Table RefreshToken {
  tokenOwnerIdRelation User [not null]
  tokenValue String [pk]
  username String [not null]
}

Table User {
  userId String [pk]
  username String [unique, not null]
  createTime DateTime [default: `now()`, not null]
  passwordHash String [not null]
  displayName String [not null]
  avatarPath String
  status UserStatus [not null, default: 'available']
  refreshTokens RefreshToken [not null]
  message Message [not null]
  roomConfig RoomConfig [not null]
  userRoom UserRoom [not null]
  rooms Room [not null]
}

Table RoomConfig {
  username String [not null]
  roomId String [not null]
  isHidden Boolean [not null, default: false]
  isNotificationMuted Boolean [not null, default: false]
  isMarkedFavourite Boolean [not null, default: false]
  isPinned Boolean [not null, default: false]
  user User [not null]
  room Room [not null]
  userRoom UserRoom

  indexes {
    (username, roomId) [pk]
  }
}

Table Room {
  roomId String [pk]
  roomType RoomType [not null]
  roomDisplayName String
  roomAvatar String
  message Message [not null]
  userRoomConfig RoomConfig [not null]
  userRoom UserRoom [not null]
  user User [not null]
}

Table UserRoom {
  username String [not null]
  roomId String [not null]
  joinedAt DateTime [default: `now()`, not null]
  isAdmin Boolean [not null, default: false]
  isBlocked Boolean [not null, default: false]
  lastReadMessage String
  user User [not null]
  room Room [not null]
  roomConfig RoomConfig [not null]

  indexes {
    (username, roomId) [pk]
  }
}

Table Message {
  key String [pk]
  senderUsername String [not null]
  roomId String [not null]
  content String [not null]
  createdAt DateTime [default: `now()`, not null]
  editedAt DateTime
  contentType MessageContentType [not null]
  sender User [not null]
  room Room [not null]
}

Table Session {
  id String [pk]
  sid String [unique, not null]
  data String [not null]
  expiresAt DateTime [not null]
}

Enum UserStatus {
  available
  dnd
  hidden
}

Enum RoomType {
  private
  group
}

Enum MessageContentType {
  audio
  video
  text
  image
  file
}

Ref: RefreshToken.username > User.username

Ref: RoomConfig.username > User.username [delete: Cascade]

Ref: RoomConfig.roomId > Room.roomId [delete: Cascade]

Ref: UserRoom.username > User.username [delete: Cascade]

Ref: UserRoom.roomId > Room.roomId [delete: Cascade]

Ref: UserRoom.(username, roomId) - RoomConfig.(username, roomId) [delete: Cascade]

Ref: Message.senderUsername > User.username [delete: Cascade]

Ref: Message.roomId > Room.roomId [delete: Cascade]