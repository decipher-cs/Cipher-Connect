generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model refreshToken {
  tokenOwnerIdRelation user   @relation(fields: [username], references: [username])
  tokenValue           String @id @map("token_value")
  username             String @map("username") @db.VarChar(16)

  @@map("refresh_token")
}

model user {
  username     String   @id @db.VarChar(16)
  displayName  String   @unique @map("display_name") @db.VarChar(16)
  passwordHash String   @map("password_hash") @db.VarChar(60)
  createTime   DateTime @default(now()) @map("create_time") @db.Timestamp(0)

  refreshTokens refreshToken[]
  message       message[]
  roomConfig    roomConfig[]
  participation userRoomParticipation[]
}

model roomConfig {
  key      Int    @id @unique @default(autoincrement())
  username String @db.VarChar(16)
  roomId   String

  isHidden Boolean @default(false)

  userRelation   user @relation(fields: [username], references: [username])
  roomIdRelation room @relation(fields: [roomId], references: [roomId])

  @@map("room_config")
  @@unique([username, roomId])
}

model room {
  roomId           String  @id @default(cuid())
  roomDisplayName  String  @db.VarChar(33)
  isMaxCapacityTwo Boolean @default(false)

  message        message[]
  userRoomConfig roomConfig[]
  participation  userRoomParticipation[]
}

model userRoomParticipation {
  key      Int    @id @unique @default(autoincrement())
  roomId   String
  username String

  roomIdRelation   room @relation(fields: [roomId], references: [roomId])
  usernameRelation user @relation(fields: [username], references: [username])

  @@map("user_room_participation")
}

model message {
  key            Int      @id @default(autoincrement())
  senderUsername String   @db.VarChar(16)
  roomId         String
  content        String   @db.LongText
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  editedAt       DateTime

  sender user @relation(fields: [senderUsername], references: [username])
  room   room @relation(fields: [roomId], references: [roomId])
}
